---
output: github_document
header-includes:
  - \usepackage{titling}
  - \pretitle{\begin{center}
    \includegraphics[width=2in,height=2in]{man/figures/logo.png}\LARGE\\}
  - \posttitle{\end{center}}
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# Quarterly Labour Force Survey data cleaning <img src="man/figures/README-lfsclean-open.png" align="right" style="padding-left:10px;background-color:white;" width="100" height="100" />

<!-- badges: start -->
[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
<!-- badges: end -->

## Motivation
The motivation for `lfsclean` is to develop a set of standard functions for processing raw data from the quarterly Labour Force Survey (LFS), which is an ongoing survey of households representative of the UK population primarily collecting demographic and labour market information such as employment status, earnings, and hours of work.

The `lfsclean` package contains functions which read in the raw data files, processes them into clean output variables, and combines all data files into a single output data table. The functions also create real-terms values for nominally valued monetary variables (earnings and wages), allowing the user to select either the CPIH or RPI.

## Installation

You can install the latest version of `lfsclean` from GitHub with:     

```{r gh_installation, message=FALSE, eval = FALSE}
#install.packages("devtools")
#install.packages("getPass")
#install.packages("git2r")

devtools::install_git(
  "https://github.com/STAPM/lfsclean.git", 
  build_vignettes = FALSE
)

```

## Usage

The **inputs** are the raw LFS data files obtained from the [UK Data Service](https://ukdataservice.ac.uk/). __These must be the tab delimited versions of the data, not Stata or SPSS__, and all individual tab delimited files needed must be placed together in a single directory. 

A typical workflow for using the package looks as follows, with the read data function for each individual year contained within a global cleaning function which applies each cleaning function in turn. The collection of global cleaning functions for each year are then wrapped in a function to combine years of data.

The `lfsclean()` wrapper function is used to process multiple quarterly cross-sectional LFS data files into a single dataset of cleaned variables.

```{r workflow, message = FALSE, eval = FALSE}

#### read in and clean raw data using the package

####################
## input arguments

root  <- "C:/"
file  <- "" # path to the folder where the tab files are
year  <- 1993:2023
ages  <- 16:64
keep_vars <- NULL
complete_vars <- NULL
deflator <- "cpih"

##############################
### LFS data 1993 - 2022

lfs_data <- lfsclean(root = root,
                     file = file,
                     year = year,
                     ages = ages,
                     keep_vars = keep_vars,
                     complete_vars = complete_vars,
                     deflator = deflator)

```

The `lfsclean_5q()` wrapper function is used to process the raw five-quarter longitudinal data. The arguments are simular to those used for the quarterly data cleaning function. `year` in this case refers to the calendar year in which the first wave of the longitudinal data was interviewed e.g. setting year equal to 2020 would read in, clean, and combine the four longitudinal datasets which began in January-March, April-June, July-September, and October-December of 2020.

```{r workflow-long, message = FALSE, eval = FALSE}

## input arguments

root  <- "U:/"
file  <- "ManWin/My Documents/Datasets/Labour Force Survey/longitudinal/tab"
year  <- 2020:2022
ages  <- 16:64
keep_vars <- NULL
complete_vars <- NULL
deflator <- "cpih"

### Read in longitudinal data

lfs_data <- lfsclean_5q(root,
                        file,
                        year = year,
                        ages = ages,
                        keep_vars = keep_vars,
                        complete_vars = complete_vars)
```

### Projects 

Some examples of projects making use of the `lfsclean` package are:

1. [Input-Output modelling](https://gitlab.com/SPECTRUM_Sheffield/projects/input-output-modelling). Here the package is used to create full-time equivalent employment by sector and year to estimate the impacts of changing demand in different sectors on total employment. 
